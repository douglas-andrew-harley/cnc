<pre>
; This G-code probes the Y0 position from front.

o104 sub

; Configuration Variables
#<probe_max_distance> = 1.0 ; In
#<backoff_rate> = 20.0 ; In/s
#<fast_probe_rate> = 10.0 ; In/s
#<fast_backoff> = 0.05 ; In
#<slow_probe_rate> = 3.75 ; In/s
#<slow_backoff> = 0.5 ; In
#<probe_bar_thick> = 0.125 ; In

M101 ; Ask user about the probe diameter

; Internal variables
#<bit_offset> = #<_hal[probe-radius]> ; In
#<probe_dir> = 1 ; -1 to probe towards negative co-ords, 1 to probe towards positive

M70 ; Save modal state
G91 ; Relative/incremental movements
G20 ; Inches

M100 P1; Enable probe input mask
G38.2 Y[#<probe_dir> * #<probe_max_distance>] F[#<fast_probe_rate>] ; Probe at fast speed to get close
M100 P0; Disable probe input mask
G01 Y[-#<probe_dir> * #<fast_backoff>] F[#<backoff_rate>]; Back off

M100 P1; Enable probe input mask
G38.2 Y[#<probe_dir> * #<probe_max_distance>] F[#<slow_probe_rate>] ; Probe at slow speed; more precise
M100 P0; Disable probe input mask
G01 Y[-#<probe_dir> * #<slow_backoff>] F[#<backoff_rate>]; Back off

; Set G54 instead of G92 since that is consistent
; with what AXIS "Touch Off" buttons do
; Set G54 offset so current co-ordinate is:
G10 L20 P1 Y[-#<probe_dir> * [#<probe_bar_thick> + #<slow_backoff> + #<bit_offset>]]

G90 ; Absolute movements
G54 ; Select the co-ordinate system just zero'd

M72 ; Restore modal state

o104 endsub
</pre>
